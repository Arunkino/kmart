{% extends 'admin/admin_theme.html' %}
{% load static %}

{% block content %}

<div class="card mb-4">
    <div class="card-header">
        <i class="fa-solid fa-layer-group"></i>
        Edit Categories
        <button id="add-category-btn" class="btn btn-success btn-sm" > Add new category</button>

        <div style="display: inline;" class="d-grid gap-2 d-md-flex justify-content-md-end">

        <a href="{% url 'add_product' %}" class="btn btn-success btn-sm" ><i class="fa-regular fa-square-plus"></i> Add Products</a>
        </div>
        <form id="add-category-form" action="{% url 'add_category' %}" method="post" style="display: none;">
            {% csrf_token %}
            <div style="display: flex; justify-content: space-between; width: 400px;">
                <input type="text" name="category_name"  class="form-control" placeholder="Enter new category" required>
                <input type="submit" value="Add" class="btn btn-secondary">
            </div>
          </form>


    </div>
    <div class="card-body">



        {% for category in categories %}
            <div class="card mb-4">
                <div class="card-header">
                    <h5 style="display: inline;">{{ category.category_name }}</h5>
        <button title="Edit category" id="update-category-btn{{category.category_id}}" class="btn btn-secondary btn-sm" ><i class="fa-regular fa-pen-to-square"></i></button>
        
                    <form class="add-subcategory-form" action="{% url 'add_subcategory' %}" method="post" style="display: none;">
                        {% csrf_token %}
                        <div style="display: flex; justify-content: space-between; width: 400px;">
                            <input type="text" name="subcategory_name" class="form-control" placeholder="Enter new subcategory" required>
                            <input type="hidden" name="category_id" value="{{category.category_id}}">
                            <input type="submit" class="btn btn-secondary" value="Submit">
                        </div>
                    </form>
                    <form id="update-category-form{{category.category_id}}" action="{% url 'update_category' %}" method="post" style="display: none;">
                        {% csrf_token %}
                        <div style="display: flex; justify-content: space-between; width: 400px;">
                            <input type="text" name="category_name" class="form-control" value="{{category.category_name}}" required>
                            <input type="hidden" name="category_id" value="{{category.category_id}}">
                            <input type="submit" class="btn btn-secondary" value="Update">
                        </div>
                    </form>
                    <div style="display: inline;" class="d-grid gap-2 d-md-flex justify-content-md-end">

                        <button class="btn btn-outline-success add-subcategory-btn" id="">Add new sub category</button>
                        <a class="btn btn-outline-danger" href="delete_category/{{ category.category_id }}" onclick="return confirm('You are deleting this category and its sub categories for ever. The products will be moved to holded list \n\n Are you sure?');"> Delete {{ category.category_name }}</a>
                       
                        
                        
                    </div>
                    
                </div>
                <div class="card-body">
                    {% for subcategory in category.subcategories %}

                    <h6 style="display: inline;">{{subcategory.subcategory_name}}</h6>
                    <button title="Edit subcategory" id="update-subcategory-btn{{subcategory.subcategory_id}}" class="btn btn-secondary btn-sm" ><i class="fa-regular fa-pen-to-square"></i></button>
                    
                    <a class="btn btn-outline-danger btn-sm" href="delete_subcategory/{{ subcategory.subcategory_id }}" onclick="return confirm('You are deleting this sub category for ever. The products will be moved to holded list \n\n Are you sure?');"> Delete {{ subcategory.subcategory_name }}</a>
                    <form id="update-subcategory-form{{subcategory.subcategory_id}}" action="{% url 'update_subcategory' %}" method="post" style="display: none;">
                        {% csrf_token %}
                        <div style="display: flex; justify-content: space-between; width: 400px;">
                            <input type="text" name="subcategory_name" class="form-control" value="{{subcategory.subcategory_name}}" required>
                            <input type="hidden" name="subcategory_id" value="{{subcategory.subcategory_id}}">
                            <input type="submit" class="btn btn-secondary" value="Update">
                        </div>
                    </form>
                        <table class="table table-striped table-hover">
                            <thead>
                                <tr>
                                    <th>Product ID</th>
                                    <th>Name</th>
                                    <th>Category</th>
                                    <th>Description</th>
                                    <th>Brand</th>
                                    <th>Stock Bal</th>
                                    <th>Price</th>
                                    <th>Image</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tfoot>
                                
                            </tfoot>
                            <tbody>
                                {% for product in subcategory.products %}
                                    {% for variant in product.variants %}

                                        <tr>
                                            <td>{{variant.id}}</td>
                                            <td>{{product.product_name}}</td>
                                            <td>{{category.category_name}}</td>
                                            <td>{{variant.description}}</td>
                                            <td>{{variant.brand}}</td>
                                            <td>{{variant.stock}}</td>
                                            <td>{{variant.price}}</td>
                                            <td><img src="{{variant.image}}" style="height: 50px;" alt=""></td>
                                            <td>edit/hold</td>
                                            
                                        </tr>
                                    {% endfor %}
                                {% endfor %}
                            </tbody>
                        </table>
                    {% endfor %}
                    
                
                </div>

            </div>

        {% endfor %}

    </div>

</div>



{% endblock %}
{% block scripts %}
<script>
    $(document).ready(function(){
        $('#add-category-btn').click(function(){
            $('#add-category-form').show();
        });
        $('.add-subcategory-btn').click(function(){
            $('.add-subcategory-form').show();
        });
        $('[id^="update-category-btn"]').click(function(){
            var categoryId = this.id.replace('update-category-btn', '');
        $('#update-category-form' + categoryId).show();
        });

        $('[id^="update-subcategory-btn"]').click(function(){
            var categoryId = this.id.replace('update-subcategory-btn', '');
        $('#update-subcategory-form' + categoryId).show();
        });

        
        
    
    
    });

</script>
{% endblock %}

           